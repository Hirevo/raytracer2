/*
** intersect_sphere.c for bootstrap raytracer1 in /home/nicolaspolomack/tests/raytracer_test
** 
** Made by Nicolas Polomack
** Login   <nicolas.polomack@epitech.eu>
** 
** Started on  Mon Feb  6 23:30:22 2017 Nicolas Polomack
** Last update Thu May 25 13:52:30 2017 CÃ©dric THOMAS
*/

#include <pthread.h>


#include <math.h>
#include <stdlib.h>
#include <SFML/Graphics.h>
#include <limits.h>
#include "raytracer.h"

#include "solver.h"

char	*intersect = "intersect_cubet";
char	*normal = "get_normal_cubet";
char    *texture = "apply_tex_cubet";
int	id = 15;

# define X		300
# define Y		300

extern sfVector2i	*g_size[8];
extern t_params		*g_params;

void	debug(t_solus *solus, t_poly *poly)
{
  float	min;
  int	i;

  i = -1;
  while (++i < 8)
    {
      if (g_params->t[i] == pthread_self())
	{
	  if (g_size[i] && g_size[i]->x == X && g_size[i]->y == Y)
	    {
	      int k = 0;
	      printf("equa : ");
	      while (k < poly->nb)
		{
		  printf("%.f", poly->poly[k]);
		  if (k + 1 != poly->nb)
		    printf("X^%d + ", poly->nb - 1 - k);
		  k += 1;
		}
	      printf("\n%d solus in (%d, %d) on thread %d\n", solus->nb, g_size[i]->x, g_size[i]->y, i);
	      int j = -1;
	      while (++j < solus->nb)
		printf("solus : %f\n", solus->solus[j]);
	      min = get_min_pos_solus(solus);
	      printf("min : %f\n", min);
	    }
	}
    }
}

float		intersect_cubet(sfVector3f eye,
				sfVector3f vec,
				t_obj *obj)
{
  float		min;
  float		equa[5];
  t_poly	*poly;
  t_solus	*solus;

  equa[0] = pow(vec.x, 4) + pow(vec.y, 4) + pow(vec.z, 4);  
  equa[1] = 4 * (pow(vec.x, 3) * eye.x + pow(vec.y, 3) * eye.y +
    		 pow(vec.z, 3) * eye.z);  
  equa[2] = 6 * (pow(vec.x, 2) * pow(eye.x, 2) +
    		 pow(vec.y, 2) * pow(eye.y, 2) +
    		 pow(vec.z, 2) * pow(eye.z, 2))
    - 5 * (pow(vec.x, 2) + pow(vec.y, 2) + pow(vec.z, 2));  
  equa[3] = 4 * (pow(eye.x, 3) * vec.x + pow(eye.y, 3) * vec.y +
    		 pow(eye.z, 3) * vec.z)
    - 10 * (eye.x * vec.x + eye.y * vec.y + eye.z * vec.z);
  equa[4] = (pow(eye.x, 4) + pow(eye.y, 4) +
    	     pow(eye.z, 4)) - 5 * (pow(eye.x, 2) + pow(eye.y, 2) + pow(eye.z, 2));  
  if ((poly = create_poly(5, equa[0], equa[1], equa[2], equa[3], equa[4])) == NULL)
    return (-1);
  solus = solver(poly);
  debug(solus, poly);
  min = get_min_pos_solus(solus);
  del_polys(poly);
  del_solus(solus);
  return (min);
}

void		get_normal_cubet(t_thread *t, t_obj *obj)
{
  t->normal.x = 4 * pow(t->normal.x, 3) - 10 * t->normal.x;
  t->normal.y = 4 * pow(t->normal.y, 3) - 10 * t->normal.y;
  t->normal.z = 4 * pow(t->normal.z, 3) - 10 * t->normal.z;
}

sfColor		apply_tex_cubet(sfVector3f imp, t_obj *obj)
{
  return (obj->col);
}
